<!DOCTYPE html> 
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<title>COUNT DOWN CAOFF 2018-2019 投票</title>
</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
<div class="container">
<table class="table" id="selectionTable">
</table>
</div>
</nav>
<div class="container" style="padding-top: 70px;padding-bottom: 70px;">
<header class="header">
<h2>COUNT DOWN・CAOFF 2018-2019投票ページ</h2>

今年も<a href="http://www.caoff.com/" target="_blank">COUNTDOWN CAOFF</a>が12月31日に開催されます。<br/>
そこで、2018年発表されたアニソンで良かったと思う曲ベスト10を決めたいと思います！<br/>
ランキングは皆さんの投票で決定します。<br/>
下のリストから３曲選んで、tweetボタンをクリックしてください。<br/>
リストになかったら、tweetボタンを押した後、編集してtweetしてくださいね。
</header>

<div class="alert alert-info">
データロード中。。。Javascriptは有効に
</div>

<ul class="list-group">
</ul>
</div>

<nav class="navbar navbar-default navbar-fixed-bottom" role="navigation">
<div class="container">
<a href="https://twitter.com/intent/tweet?button_hashtag=caoff2017&text=" class="twitter-hashtag-button btn btn-primary btn-lg btn-block" role="button" data-lang="ja" data-role="button">Tweet #caoff2017</a><br/>
</div>
</nav>
<script type="text/javascript"
  src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script type="text/javascript"><!--
var selectTitles = [];
var loadSelection = function() {
    var tbl = $("#selectionTable");
    tbl.html("");
    var text = "";
    for(var i=1; i<= selectTitles.length; i++) {
        row = $("<tr></tr>");
        row.append("<td>"+i+"位</td>");
        row.append("<td>"+selectTitles[i-1]+"</td>");
        if(i==1) {
            row.append("<td></td>");
        } else {
            row.append("<td><a onclick='upTitle("+(i-1)+");'>　▲　</a></td>");
        }
        if(i==selectTitles.length) {
            row.append("<td></td>");
        } else {
            row.append("<td><a onclick='upTitle("+i+");'>　▼　</a></td>");
        }
        row.append("<td><a class=\"btn btn-danger\" onclick='deleteTitle(\""+selectTitles[i-1]+"\");'>削除</a></td>");
        tbl.append(row);
        text += i+"位:"+selectTitles[i-1]+"\n";
    }
    text += "https://goo.gl/MTl6sH";
    var url = "https://twitter.com/intent/tweet?button_hashtag=caoff2017&text=";
    $('.twitter-hashtag-button').attr("href", url+encodeURIComponent(text));
}
var deleteTitle = function(title) {
    for(var i=0; i< selectTitles.length; i++) {
        if (selectTitles[i]==title) {
            selectTitles.splice(i,1);
            break;
        }
    }
    $('.list-group-item[data-val="'+title+'"]').removeClass("active");
    loadSelection();
}
var upTitle = function(index) {
    selectTitles.splice(index-1,2,selectTitles[index],selectTitles[index-1]);
    loadSelection();
}
$.get("https://spreadsheets.google.com/feeds/list/13Ss_ox1Z7h0OUL_dBcmk0Z5yhrC52LZp4KDlP7JZ1xg/oty81yf/public/values?alt=json",
 function(json) { 
    var entrys = json.feed.entry;
    var len = entrys.length;
    
    for(var i=0; i < len; i++){
      row = $('<a href="javascript:void(0)" class="list-group-item"><h4 class="list-group-item-heading"></h4><p class="list-group-item-text"></p></a>');
      row.attr("data-val", entrys[i].title.$t+"/"+entrys[i].gsx$タイアップ.$t);
      row.find(".list-group-item-heading").text(entrys[i].title.$t);
      row.find(".list-group-item-text").text(entrys[i].gsx$タイアップ.$t);
      $(".list-group").append(row);
    }
    $(".alert").remove();

    $(".list-group-item").click(function() {
      if ($(this).hasClass("active")) {
          //$(this).removeClass("active");
          deleteTitle($(this).attr("data-val"));
      } else {
          if($(".list-group-item.active").length>=3) {
              alert("選べるのは３つまで！");
              return false;
          }
          $(this).addClass("active");
          selectTitles.push($(this).attr("data-val"));
          loadSelection();
      }
    });
  } 
);
//-->
</script>
</body>
</html>
